import{r as i,j as t}from"./index-3iRPG9Bu.js";import{b as m,a as k}from"./index.esm-aB2BTCbt.js";import{C as u}from"./CAlert-CS1k0cQ9.js";import{C as L,a as P}from"./CCardBody-ZnA988Qk.js";import{C as Q}from"./CCardHeader-D5Sem3LH.js";import{c as D}from"./cil-plus-D8mtC-W5.js";import{C as G,a as $,b as E,c as h,d as F,e as p,f as J,g as R,h as U,i as W,j as K,k as V,l as X}from"./cil-trash-DC43jLP2.js";import{C as Y}from"./TeacherContent-4OZygDT1.js";import{C as S}from"./CFormInput-BjgXPPX5.js";import{c as Z}from"./cil-warning-C7g3f07Q.js";import"./CCloseButton-B86-_tbR.js";import"./useForkedRef-DSh7hi_l.js";import"./cil-sun-Cy5DgvOh.js";import"./cil-user-Ddrdy7PS.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-DTREpq_c.js";const je=()=>{const[b,N]=i.useState([]),[T,w]=i.useState(!0),[j,o]=i.useState(null),[M,l]=i.useState(!1),[a,d]=i.useState({id:null,item:"",stock:0,minStock:10,status:"In Stock"}),[C,g]=i.useState(!1),[v,c]=i.useState(""),z=()=>localStorage.getItem("authToken")||"",f=()=>({"Content-Type":"application/json",Authorization:`Bearer ${z()}`});i.useEffect(()=>{x()},[]);const x=async()=>{try{w(!0);const e=await fetch("https://application-backend-4anj.onrender.com/api/item",{headers:f()});if(!e.ok)throw new Error("Error al cargar el inventario");const s=await e.json();N(s.map(r=>({...r,stock:r.quantity||r.stock,minStock:r.minQuantity||r.minStock||10,status:I(r.quantity,r.minQuantity||10)})))}catch(e){o(e.message)}finally{w(!1)}},B=e=>{switch(e){case"In Stock":return"success";case"Low Stock":return"warning";case"Critical":return"danger";case"Out of Stock":return"secondary";default:return"secondary"}},I=(e,s)=>e===0?"Out of Stock":e<s*.25?"Critical":e<s?"Low Stock":"In Stock",q=async e=>{var s,r;try{const n=await fetch("https://application-backend-4anj.onrender.com/api/item",{method:"POST",headers:f(),body:JSON.stringify({name:e.item,quantity:parseInt(e.stock),minQuantity:parseInt(e.minStock)})});if(!n.ok){if(n.status===400){const y=await n.json();throw new Error(((r=(s=y.errors)==null?void 0:s[0])==null?void 0:r.message)||"Datos inválidos")}throw new Error("Error al crear el ítem")}c("Ítem creado exitosamente"),x()}catch(n){o(n.message)}finally{g(!1)}},A=async e=>{var s,r;try{const n=await fetch(`https://application-backend-4anj.onrender.com/api/item/${e.id}`,{method:"PUT",headers:f(),body:JSON.stringify({name:e.item,quantity:parseInt(e.stock),minQuantity:parseInt(e.minStock)})});if(!n.ok){if(n.status===400){const y=await n.json();throw new Error(((r=(s=y.errors)==null?void 0:s[0])==null?void 0:r.message)||"Datos inválidos")}throw new Error("Error al actualizar el ítem")}c("Ítem actualizado exitosamente"),x()}catch(n){o(n.message)}finally{g(!1)}},H=async e=>{if(window.confirm("¿Estás seguro de eliminar este ítem?"))try{if(!(await fetch(`https://application-backend-4anj.onrender.com/api/item/${e}`,{method:"DELETE",headers:f()})).ok)throw new Error("Error al eliminar el ítem");c("Ítem eliminado exitosamente"),x()}catch(s){o(s.message)}},O=()=>{if(!a.item.trim()){o("El nombre del ítem es requerido");return}g(!0),c(""),o("");const e={...a,stock:parseInt(a.stock),minStock:parseInt(a.minStock),status:I(a.stock,a.minStock)};e.id?A(e):q(e),l(!1)};return T?t.jsx(u,{color:"info",children:"Cargando inventario..."}):j?t.jsx(u,{color:"danger",children:j}):t.jsxs(L,{className:"mb-4",children:[t.jsxs(Q,{className:"d-flex justify-content-between align-items-center",children:[t.jsx("h5",{className:"mb-0",children:"Gestión de Inventario"}),t.jsxs(m,{color:"primary",size:"sm",onClick:()=>{d({id:null,item:"",stock:0,minStock:10,status:"In Stock"}),o(""),c(""),l(!0)},children:[t.jsx(k,{icon:D,className:"me-2"}),"Nuevo Ítem"]})]}),t.jsxs(P,{children:[t.jsxs(G,{hover:!0,responsive:!0,children:[t.jsx($,{children:t.jsxs(E,{children:[t.jsx(h,{children:"ID"}),t.jsx(h,{children:"Ítem"}),t.jsx(h,{children:"Stock"}),t.jsx(h,{children:"Estado"}),t.jsx(h,{children:"Acciones"})]})}),t.jsx(F,{children:b.map(e=>t.jsxs(E,{children:[t.jsx(p,{children:e.id}),t.jsx(p,{children:e.name||e.item}),t.jsx(p,{children:e.stock}),t.jsx(p,{children:t.jsx(Y,{color:B(e.status),children:e.status})}),t.jsxs(p,{children:[t.jsx(m,{color:"primary",size:"sm",className:"me-2",onClick:()=>{d({id:e.id,item:e.name||e.item,stock:e.stock,minStock:e.minStock||10,status:e.status}),o(""),c(""),l(!0)},children:t.jsx(k,{icon:J})}),t.jsx(m,{color:"danger",size:"sm",onClick:()=>H(e.id),children:t.jsx(k,{icon:R})})]})]},e.id))})]}),t.jsxs(U,{visible:M,onClose:()=>l(!1),children:[t.jsx(W,{children:t.jsx(K,{children:a.id?"Editar Ítem":"Nuevo Ítem"})}),t.jsxs(V,{children:[j&&t.jsx(u,{color:"danger",children:j}),v&&t.jsx(u,{color:"success",children:v}),t.jsx("div",{className:"mb-3",children:t.jsx(S,{label:"Nombre del ítem",value:a.item,onChange:e=>d(s=>({...s,item:e.target.value}))})}),t.jsxs("div",{className:"row g-3",children:[t.jsx("div",{className:"col-6",children:t.jsx(S,{type:"number",label:"Stock actual",value:a.stock,min:"0",onChange:e=>d(s=>({...s,stock:e.target.value}))})}),t.jsx("div",{className:"col-6",children:t.jsx(S,{type:"number",label:"Stock mínimo",value:a.minStock,min:"0",onChange:e=>d(s=>({...s,minStock:e.target.value}))})})]})]}),t.jsxs(X,{children:[t.jsx(m,{color:"secondary",onClick:()=>l(!1),disabled:C,children:"Cancelar"}),t.jsx(m,{color:"primary",onClick:O,disabled:C,children:C?"Guardando...":a.id?"Guardar Cambios":"Crear Ítem"})]})]}),t.jsxs(u,{color:"warning",className:"mt-3",children:[t.jsx(k,{icon:Z,className:"me-2"}),b.filter(e=>e.status==="Critical").length," ítems en estado crítico"]})]})]})};export{je as default};
