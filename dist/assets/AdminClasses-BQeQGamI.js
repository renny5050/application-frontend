import{r as t,j as a}from"./index-3iRPG9Bu.js";import{a as n,b as h}from"./index.esm-aB2BTCbt.js";import{C}from"./CAlert-CS1k0cQ9.js";import{C as $,a as z}from"./CCardBody-ZnA988Qk.js";import{C as A}from"./CCardHeader-D5Sem3LH.js";import{C as I,a as L,b,c as l,d as P,e as c,f as B,g as R,h as F,i as G,j as J,k as O,l as U}from"./cil-trash-DC43jLP2.js";import{e as W}from"./TeacherContent-4OZygDT1.js";import{c as V}from"./cil-calendar-B69zOQSH.js";import{C as p}from"./CFormSelect-B25eiRp0.js";import{c as q}from"./cil-warning-C7g3f07Q.js";import"./CCloseButton-B86-_tbR.js";import"./useForkedRef-DSh7hi_l.js";import"./cil-sun-Cy5DgvOh.js";import"./cil-user-Ddrdy7PS.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-DTREpq_c.js";const me=()=>{const v=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],f=Array.from({length:48},(e,s)=>{const u=Math.floor(s/2),x=s%2===0?"00":"30";return`${String(u).padStart(2,"0")}:${x}`}),[y,T]=t.useState([]),[S,E]=t.useState([]),[k,g]=t.useState(!0),[_,i]=t.useState(null),[N,d]=t.useState(!1),[r,o]=t.useState({id:null,teacher_id:"",specialty_id:"",day:"Lunes",startTime:"09:00",endTime:"10:00",teacher_name:"",specialty_name:""}),w=()=>localStorage.getItem("authToken")||"",m=()=>({"Content-Type":"application/json",Authorization:`Bearer ${w()}`});t.useEffect(()=>{j()},[]);const j=async()=>{try{g(!0);const[e,s]=await Promise.all([fetch("https://application-backend-4anj.onrender.com/api/classes/",{headers:m()}),fetch("https://application-backend-4anj.onrender.com/api/teachers/",{headers:m()})]);if(!e.ok||!s.ok)throw new Error("Error al cargar datos");const u=await e.json(),x=await s.json();T(u),E(x)}catch(e){i(e.message)}finally{g(!1)}},D=e=>{o({id:e.id,teacher_id:e.teacher_id.toString(),specialty_id:e.specialty_id.toString(),day:e.day.charAt(0).toUpperCase()+e.day.slice(1).toLowerCase(),startTime:e.start_time.slice(0,5),endTime:e.end_time.slice(0,5),teacher_name:e.teacher_name,specialty_name:e.specialty_name}),d(!0)},H=async()=>{try{const e=await fetch(`https://application-backend-4anj.onrender.com/api/classes/${r.id}`,{method:"PUT",headers:m(),body:JSON.stringify({specialty_id:parseInt(r.specialty_id),teacher_id:parseInt(r.teacher_id),day:r.day.toLowerCase(),start_time:r.startTime,end_time:r.endTime})});e.ok?(j(),d(!1)):e.status===401?i("No autorizado. Inicia sesión nuevamente."):i("Error al guardar los cambios.")}catch(e){console.error("Error actualizando clase:",e),i("Hubo un problema al actualizar la clase.")}},M=async e=>{if(window.confirm("¿Estás seguro de eliminar esta clase?"))try{const s=await fetch(`https://application-backend-4anj.onrender.com/api/classes/${e}`,{method:"DELETE",headers:m()});s.ok?j():s.status===401?i("No autorizado. Inicia sesión nuevamente."):i("Error al eliminar la clase.")}catch(s){console.error("Error eliminando clase:",s),i("Hubo un problema al eliminar la clase.")}};return k?a.jsx(C,{color:"info",children:"Cargando datos..."}):_?a.jsx(C,{color:"danger",children:_}):a.jsxs($,{className:"mb-4",children:[a.jsx(A,{children:a.jsx("h5",{className:"mb-0",children:"Gestión de Clases"})}),a.jsxs(z,{children:[a.jsxs(I,{hover:!0,responsive:!0,children:[a.jsx(L,{children:a.jsxs(b,{children:[a.jsx(l,{children:"ID"}),a.jsx(l,{children:"Profesor"}),a.jsx(l,{children:"Especialidad"}),a.jsx(l,{children:"Horario"}),a.jsx(l,{children:"Acciones"})]})}),a.jsx(P,{children:y.map(e=>a.jsxs(b,{children:[a.jsx(c,{children:e.id}),a.jsxs(c,{children:[a.jsx(n,{icon:W,className:"me-2"}),e.teacher_name]}),a.jsx(c,{children:e.specialty_name}),a.jsxs(c,{children:[a.jsx(n,{icon:V,className:"me-2"}),`${e.day} ${e.start_time.slice(0,5)} - ${e.end_time.slice(0,5)}`]}),a.jsxs(c,{children:[a.jsx(h,{color:"primary",size:"sm",className:"me-2",onClick:()=>D(e),children:a.jsx(n,{icon:B})}),a.jsx(h,{color:"danger",size:"sm",onClick:()=>M(e.id),children:a.jsx(n,{icon:R})})]})]},e.id))})]}),a.jsxs(F,{visible:N,onClose:()=>d(!1),children:[a.jsx(G,{children:a.jsx(J,{children:"Editar Clase"})}),a.jsx(O,{children:a.jsxs("div",{className:"gap-3",children:[a.jsx("div",{className:"mb-3",children:a.jsxs(p,{label:"Profesor",value:r.teacher_id,onChange:e=>o(s=>({...s,teacher_id:e.target.value})),children:[a.jsx("option",{value:"",children:"Seleccionar profesor"}),S.map(e=>a.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})}),a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-4",children:a.jsx(p,{label:"Día",value:r.day,onChange:e=>o(s=>({...s,day:e.target.value})),children:v.map(e=>a.jsx("option",{value:e,children:e},e))})}),a.jsx("div",{className:"col-4",children:a.jsx(p,{label:"Hora inicio",value:r.startTime,onChange:e=>o(s=>({...s,startTime:e.target.value})),children:f.map(e=>a.jsx("option",{value:e,children:e},e))})}),a.jsx("div",{className:"col-4",children:a.jsx(p,{label:"Hora fin",value:r.endTime,onChange:e=>o(s=>({...s,endTime:e.target.value})),children:f.map(e=>a.jsx("option",{value:e,children:e},e))})})]})]})}),a.jsxs(U,{children:[a.jsx(h,{color:"secondary",onClick:()=>d(!1),children:"Cancelar"}),a.jsx(h,{color:"primary",onClick:H,children:"Guardar Cambios"})]})]}),a.jsxs(C,{color:"info",className:"mt-3",children:[a.jsx(n,{icon:q,className:"me-2"}),"Total de clases registradas: ",y.length]})]})]})};export{me as default};
