import{r as o,j as a}from"./index-3iRPG9Bu.js";import{a as p,b as D}from"./index.esm-aB2BTCbt.js";import{C as F,a as B}from"./CCardBody-ZnA988Qk.js";import{C as P}from"./CCardHeader-D5Sem3LH.js";import{c as $}from"./cil-calendar-B69zOQSH.js";import{C as z}from"./CForm-B3srEGj3.js";import{C as G,a as d}from"./CRow-BGaT1TWU.js";import{C as u}from"./CFormSelect-B25eiRp0.js";import{C as S}from"./CAlert-CS1k0cQ9.js";import{c as J}from"./cil-warning-C7g3f07Q.js";import{c as T}from"./cil-plus-D8mtC-W5.js";import"./CFormControlWrapper-DTREpq_c.js";import"./CCloseButton-B86-_tbR.js";import"./useForkedRef-DSh7hi_l.js";const ie=({onSuccess:f})=>{const[s,m]=o.useState({specialty_id:"",teacher_id:"",schedule:{days:[],startTime:"",endTime:""}}),[n,_]=o.useState({}),[g,C]=o.useState(!1),[y,j]=o.useState(""),[b,h]=o.useState(""),[E,N]=o.useState([]),[k,w]=o.useState([]),[l,I]=o.useState(!0),[c,A]=o.useState(!0),v=Array.from({length:48},(e,r)=>{const t=Math.floor(r/2),i=r%2*30;return`${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}`}),H=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],M=()=>localStorage.getItem("authToken")||"",x=()=>({"Content-Type":"application/json",Authorization:`Bearer ${M()}`});o.useEffect(()=>{const e=async()=>{try{const t=await fetch("https://application-backend-4anj.onrender.com/api/specialties",{method:"GET",headers:x()});if(!t.ok)throw new Error("Error al cargar las especialidades");const i=await t.json();N(i)}catch{h("No se pudieron cargar las especialidades. Intente más tarde.")}finally{I(!1)}},r=async()=>{try{const t=await fetch("https://application-backend-4anj.onrender.com/api/teachers",{method:"GET",headers:x()});if(!t.ok)throw new Error("Error al cargar los profesores");const i=await t.json();w(i)}catch{h("No se pudieron cargar los profesores. Intente más tarde.")}finally{A(!1)}};e(),r()},[]);const O=()=>{const e={};if(s.specialty_id||(e.specialty="Seleccione una especialidad"),s.teacher_id||(e.teacher="Seleccione un profesor"),s.schedule.days.length===0&&(e.days="Seleccione al menos un día"),!s.schedule.startTime||!s.schedule.endTime)e.time="Seleccione el horario completo";else{const[r,t]=s.schedule.startTime.split(":").map(Number),[i,L]=s.schedule.endTime.split(":").map(Number);i>r||i===r&&L>t||(e.time="La hora de fin debe ser posterior a la hora de inicio")}return _(e),Object.keys(e).length===0},q=async e=>{var r;if(e.preventDefault(),!!O()){C(!0),j(""),h("");try{const t=await fetch("https://application-backend-4anj.onrender.com/api/classes",{method:"POST",headers:x(),body:JSON.stringify({specialty_id:parseInt(s.specialty_id),teacher_id:parseInt(s.teacher_id),day:(r=s.schedule.days[0])==null?void 0:r.toLowerCase(),start_time:s.schedule.startTime,end_time:s.schedule.endTime})});if(t.ok)j("¡Clase creada exitosamente!"),f==null||f(),m({specialty_id:"",teacher_id:"",schedule:{days:[],startTime:"",endTime:""}}),setTimeout(()=>j(""),3e3);else if(t.status===401)h("No autorizado. Inicie sesión nuevamente.");else{const i=await t.json();h(i.message||"Error al crear la clase. Intente nuevamente.")}}catch{h("Hubo un problema al conectar con el servidor.")}finally{C(!1)}}};return a.jsxs(F,{className:"mb-4",children:[a.jsxs(P,{className:"d-flex align-items-center",children:[a.jsx(p,{icon:$,className:"me-2"}),"Crear Nueva Clase"]}),a.jsx(B,{children:a.jsx(z,{onSubmit:q,children:a.jsxs(G,{className:"g-3",children:[a.jsxs(d,{md:6,children:[a.jsxs(u,{label:"Especialidad",value:s.specialty_id,onChange:e=>m({...s,specialty_id:e.target.value}),invalid:!!n.specialty,feedback:n.specialty,required:!0,disabled:l||c,children:[a.jsx("option",{value:"",children:"Seleccionar especialidad"}),E.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),l&&a.jsx("small",{children:"Cargando especialidades..."})]}),a.jsxs(d,{md:6,children:[a.jsxs(u,{label:"Profesor",value:s.teacher_id,onChange:e=>m({...s,teacher_id:e.target.value}),invalid:!!n.teacher,feedback:n.teacher,required:!0,disabled:c||l,children:[a.jsx("option",{value:"",children:"Seleccionar profesor"}),k.map(e=>a.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]}),c&&a.jsx("small",{children:"Cargando profesores..."})]}),a.jsx(d,{md:6,children:a.jsxs(u,{label:"Días de clase",value:s.schedule.days,onChange:e=>m({...s,schedule:{...s.schedule,days:Array.from(e.target.selectedOptions).map(r=>r.value)}}),invalid:!!n.days,feedback:n.days,required:!0,disabled:c||l,children:[a.jsx("option",{value:"",disabled:!0,children:"Seleccione los días"}),H.map((e,r)=>a.jsx("option",{value:e,children:e},r))]})}),a.jsx(d,{md:4,children:a.jsxs(u,{label:"Hora de inicio",value:s.schedule.startTime,onChange:e=>m({...s,schedule:{...s.schedule,startTime:e.target.value}}),invalid:!!n.time,required:!0,disabled:c||l,children:[a.jsx("option",{value:"",children:"Seleccione hora"}),v.map((e,r)=>a.jsx("option",{value:e,children:e},r))]})}),a.jsx(d,{md:4,children:a.jsxs(u,{label:"Hora de fin",value:s.schedule.endTime,onChange:e=>m({...s,schedule:{...s.schedule,endTime:e.target.value}}),invalid:!!n.time,required:!0,disabled:c||l,children:[a.jsx("option",{value:"",children:"Seleccione hora"}),v.map((e,r)=>a.jsx("option",{value:e,children:e},r))]})}),a.jsxs(d,{xs:12,children:[b&&a.jsxs(S,{color:"danger",children:[a.jsx(p,{icon:J,className:"me-2"}),b]}),y&&a.jsxs(S,{color:"success",children:[a.jsx(p,{icon:T,className:"me-2"}),y]})]}),a.jsx(d,{xs:12,className:"text-end",children:a.jsxs(D,{type:"submit",color:"primary",disabled:g||c||l,children:[g?"Creando...":"Crear Clase",a.jsx(p,{icon:T,className:"ms-2"})]})})]})})})]})};export{ie as default};
