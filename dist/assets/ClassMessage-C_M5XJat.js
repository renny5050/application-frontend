import{r as t,j as e}from"./index-3iRPG9Bu.js";import{b as h,a as l}from"./index.esm-aB2BTCbt.js";import{C as O,a as V}from"./CCardBody-ZnA988Qk.js";import{C as Z}from"./CCardHeader-D5Sem3LH.js";import{c as J}from"./cil-plus-D8mtC-W5.js";import{C as i}from"./CAlert-CS1k0cQ9.js";import{C as v}from"./CForm-B3srEGj3.js";import{C as R}from"./CFormSelect-B25eiRp0.js";import{c as U}from"./cil-warning-C7g3f07Q.js";import{C as W,a as G,b as M,c as g,d as K,e as y,f as Q,g as X,h as Y,i as ee,j as se,k as ae,l as re}from"./cil-trash-DC43jLP2.js";import{c as te}from"./cil-calendar-B69zOQSH.js";import{C as N}from"./CFormInput-BjgXPPX5.js";import"./CCloseButton-B86-_tbR.js";import"./useForkedRef-DSh7hi_l.js";import"./CFormControlWrapper-DTREpq_c.js";import"./TeacherContent-4OZygDT1.js";import"./cil-sun-Cy5DgvOh.js";import"./cil-user-Ddrdy7PS.js";import"./cil-lock-locked-DmxpJbVL.js";var ne=["512 512","<rect width='34.924' height='34.924' x='256' y='95.998' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M16,496H496V16H16ZM48,48H464V464H48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M285.313,359.032a18.123,18.123,0,0,1-15.6,8.966,18.061,18.061,0,0,1-17.327-23.157l35.67-121.277A49.577,49.577,0,0,0,194.7,190.572l-11.718,28.234,29.557,12.266,11.718-28.235a17.577,17.577,0,0,1,33.1,11.7l-35.67,121.277A50.061,50.061,0,0,0,269.709,400a50.227,50.227,0,0,0,43.25-24.853l15.1-25.913-27.646-16.115Z' class='ci-primary'/>"];const ke=()=>{const[k,u]=t.useState([]),[S,T]=t.useState([]),[oe,ce]=t.useState(!0),[j,c]=t.useState(null),[p,x]=t.useState(""),[F,d]=t.useState(!1),[m,w]=t.useState(!1),[r,C]=t.useState({id:null,class_id:"",title:"",content:"",created_at:null}),[n,H]=t.useState({class_id:""}),E=()=>localStorage.getItem("authToken")||"",D=()=>{const s=E();if(!s)return null;try{return JSON.parse(atob(s.split(".")[1]))}catch(a){return console.error("Error decodificando token:",a),null}},f=()=>({"Content-Type":"application/json",Authorization:`Bearer ${E()}`}),A=async()=>{try{const s=D();if(!(s!=null&&s.id))throw new Error("No se pudo obtener el ID del profesor");const a=await fetch(`https://application-backend-4anj.onrender.com/api/classes/teacher/${s.id}`,{headers:f()});if(!a.ok)throw new Error("Error al cargar clases");const o=await a.json();T(o)}catch(s){c(s.message)}},b=async s=>{if(!s){u([]);return}try{const a=await fetch(`https://application-backend-4anj.onrender.com/api/classmessage/class/${s}`,{headers:f()});if(!a.ok){if(a.status===404){u([]);return}throw new Error("Error al cargar mensajes")}const o=await a.json();u(o)}catch(a){c(a.message),u([])}};t.useEffect(()=>{A()},[]),t.useEffect(()=>{n.class_id&&b(n.class_id)},[n.class_id]);const B=()=>{C({id:null,class_id:n.class_id||"",title:"",content:"",created_at:null}),w(!1),d(!0),c(""),x("")},I=s=>{C({id:s.id,class_id:s.class_id,title:s.title,content:s.content,created_at:s.created_at?new Date(s.created_at):null}),w(!0),d(!0),c(""),x("")},z=async s=>{if(window.confirm("¿Estás seguro de eliminar este mensaje?"))try{const a=await fetch(`https://application-backend-4anj.onrender.com/api/classmessage/${s}`,{method:"DELETE",headers:f()});if(!a.ok)throw a.status===404?new Error("Mensaje no encontrado"):new Error("Error al eliminar el mensaje");x("Mensaje eliminado exitosamente"),b(n.class_id)}catch(a){c(a.message)}},$=async()=>{var s,a;if(!((s=r.title)!=null&&s.trim())||!((a=r.content)!=null&&a.trim())){c("Título y contenido son requeridos");return}try{const o=m?`https://application-backend-4anj.onrender.com/api/classmessage/${r.id}`:"https://application-backend-4anj.onrender.com/api/classmessage",_=await fetch(o,{method:m?"PUT":"POST",headers:f(),body:JSON.stringify({class_id:parseInt(r.class_id),title:r.title.trim(),content:r.content.trim()})});if(!_.ok){const L=await _.json();throw new Error(L.message||"Error al guardar el mensaje")}x(m?"Mensaje actualizado":"Mensaje creado"),b(r.class_id),d(!1)}catch(o){c(o.message)}},q=s=>{const{name:a,value:o}=s.target;H({...n,[a]:o})},P=s=>s?new Date(s).toLocaleString("es-VE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return e.jsxs(O,{className:"mb-4",children:[e.jsxs(Z,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Mensajes de Clase"}),e.jsx("div",{children:e.jsxs(h,{color:"primary",onClick:B,disabled:!n.class_id,children:[e.jsx(l,{icon:J,className:"me-2"}),"Nuevo Mensaje"]})})]}),e.jsxs(V,{children:[j&&e.jsx(i,{color:"danger",children:j}),p&&e.jsx(i,{color:"success",children:p}),e.jsxs("div",{className:"mb-4 p-3 border rounded bg-light",children:[e.jsx("h6",{children:"Filtrar por Clase"}),e.jsx(v,{children:e.jsxs(R,{name:"class_id",value:n.class_id,onChange:q,label:"Clase",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar clase"}),S.map(s=>e.jsxs("option",{value:s.id,children:[s.specialty_name," - ",s.day]},s.id))]})})]}),n.class_id?e.jsxs(W,{hover:!0,responsive:!0,children:[e.jsx(G,{children:e.jsxs(M,{children:[e.jsx(g,{children:"Título"}),e.jsx(g,{children:"Contenido"}),e.jsx(g,{children:"Fecha"}),e.jsx(g,{children:"Acciones"})]})}),e.jsx(K,{children:k.map(s=>e.jsxs(M,{children:[e.jsx(y,{children:s.title}),e.jsx(y,{children:s.content}),e.jsxs(y,{children:[e.jsx(l,{icon:te,className:"me-2"}),P(s.created_at)]}),e.jsxs(y,{children:[e.jsx(h,{color:"info",size:"sm",className:"me-2",onClick:()=>I(s),children:e.jsx(l,{icon:Q})}),e.jsx(h,{color:"danger",size:"sm",onClick:()=>z(s.id),children:e.jsx(l,{icon:X})})]})]},s.id))})]}):e.jsxs(e.Fragment,{children:[e.jsxs(i,{color:"info",className:"text-center",children:[e.jsx(l,{icon:ne,className:"me-2"}),"Selecciona una clase para ver sus mensajes"]}),e.jsxs(i,{color:"secondary",className:"text-center",children:[e.jsx(l,{icon:U,className:"me-2"}),"No hay mensajes para esta clase"]})]}),e.jsxs(Y,{visible:F,onClose:()=>d(!1),children:[e.jsx(ee,{children:e.jsx(se,{children:m?"Editar Mensaje":"Nuevo Mensaje"})}),e.jsx(ae,{children:e.jsxs(v,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(N,{label:"Título",value:r.title,onChange:s=>C({...r,title:s.target.value}),required:!0})}),e.jsx("div",{className:"mb-3",children:e.jsx(N,{label:"Contenido",value:r.content,onChange:s=>C({...r,content:s.target.value}),required:!0,as:"textarea",rows:5})}),j&&e.jsx(i,{color:"danger",className:"mt-3",children:j}),p&&e.jsx(i,{color:"success",className:"mt-3",children:p})]})}),e.jsxs(re,{children:[e.jsx(h,{color:"secondary",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(h,{color:"primary",onClick:$,children:m?"Actualizar":"Crear"})]})]})]})]})};export{ke as default};
